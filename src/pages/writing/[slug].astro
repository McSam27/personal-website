---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import SectionFadeIn from '../../components/SectionFadeIn.tsx';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('writing');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<BaseLayout title={`${post.data.title} â€” smccagg`} description={post.data.description}>
  <Header />
  <main class="pt-32 pb-20 px-6">
    <article class="max-w-2xl mx-auto">
      <SectionFadeIn client:visible>
        <a
          href="/"
          class="font-mono text-sm mb-8 inline-block transition-colors duration-200 hover:text-accent-orange"
          style="color: var(--text-secondary); text-decoration: none;"
        >
          &larr; back
        </a>
        <h1 class="font-mono text-3xl sm:text-4xl font-bold mb-4" style="color: var(--text-primary);">
          {post.data.title}
        </h1>
        <p class="font-mono text-sm mb-8" style="color: var(--text-secondary);">
          {new Date(post.data.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
        </p>
        {post.data.tags && (
          <div class="flex flex-wrap gap-2 mb-8">
            {post.data.tags.map((tag: string) => (
              <span
                class="font-mono text-xs px-2 py-1 rounded"
                style="background-color: var(--bg-surface); color: var(--text-secondary);"
              >
                {tag}
              </span>
            ))}
          </div>
        )}
      </SectionFadeIn>
      <SectionFadeIn client:visible delay={0.1}>
        <div class="prose font-sans text-base leading-relaxed" style="color: var(--text-primary);">
          <Content />
        </div>
      </SectionFadeIn>
    </article>
  </main>
  <Footer />
</BaseLayout>

<style>
  .prose :global(p) {
    margin-bottom: 1.25em;
    color: var(--text-primary);
  }
  .prose :global(h2) {
    font-family: var(--font-mono);
    font-size: 1.25rem;
    font-weight: 700;
    margin-top: 2em;
    margin-bottom: 0.75em;
    color: var(--text-primary);
  }
  .prose :global(h3) {
    font-family: var(--font-mono);
    font-size: 1.1rem;
    font-weight: 700;
    margin-top: 1.5em;
    margin-bottom: 0.5em;
    color: var(--text-primary);
  }
  .prose :global(a) {
    color: var(--accent-orange);
    text-decoration: underline;
    text-underline-offset: 2px;
  }
  .prose :global(code) {
    font-family: var(--font-mono);
    font-size: 0.875em;
    background-color: var(--bg-surface);
    padding: 0.2em 0.4em;
    border-radius: 4px;
  }
  .prose :global(blockquote) {
    border-left: 3px solid var(--accent-orange);
    padding-left: 1em;
    margin-left: 0;
    font-style: italic;
    color: var(--text-secondary);
  }
</style>
